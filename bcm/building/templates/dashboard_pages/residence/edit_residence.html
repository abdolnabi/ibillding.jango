{% extends '../dashboard_base.html' %}{# in this Line, Parent of this Page will Define! #}
{% load static i18n %}
{% block bodycontent %}
    <div id="new_block_message"></div>
    <form class="form-horizontal" id='new_block'>

        {% csrf_token %}

        {% include "../../dashboard_pages/residence/form/residence_form.html" %}
        <!-- third part of form -->
        <div class="row">
            <div class="col-lg-12">
                <!-- Editable table -->
                <div class="card">
                    <div class="c-card-header">
                        <strong>{% trans 'Residence Facilities' %}</strong></div>
                    <div class="card-body">
                        <div id="table" class="table-editable">
                            <span class="table-add float-right mb-3 mr-2"><button class="btn btn-info cil-plus"
                                                                                  id="addrow"
                                                                                  type="button"></button></span>
                            <table id="dataTable"
                                   class="dataTable table table-bordered table-responsive-md table-striped text-center">

                                <thead>
                                <th>{% trans 'Title' %}</th>
                                <th>{% trans 'Description' %}</th>
                                <th>{% trans 'Price' %}</th>
                                <th>{% trans 'Requestable' %}</th>
                                <th>{% trans 'َAction' %}</th>
                                </thead>
                                <tbody id="tbody" class="center">
                                <form class="edit_facility">
                                {% for facility in residence_facility %}
                                <tr>

                                    <td><label for="id_title' + {{ facility.id }} + '"></label><input type="text" class="form-control" id="id_title' + {{ facility.id }} + '" name="title' + {{ facility.id }} + '" /></td>
                                    <td><textarea cols="30" rows="3" id="id_description' + {{ facility.id }} + '" name="description' + {{ facility.id }} + '" class="form-control" /></td>
                                    <td><label for="id_price' + {{ facility.id }} + '"></label><input class="form-control" type="text" id="id_price' + {{ facility.id }} + '" name="price' + {{ facility.id }} + '"></td>
                                    <td><label for="id_requestable' + {{ facility.id }} + '" class="c-switch c-switch-label c-switch-pill c-switch-primary"><input class="c-switch-input" id="id_requestable' + {{ facility.id }} + '" name="requestable' + {{ facility.id }} + '" type="checkbox" checked=""><span class="c-switch-slider" data-checked="✓" data-unchecked="✕"></span></label></td>
                                    <td><button class="ibtnDel btn btn-danger cil-trash"></button></td>
                                    <td><input class="btn btn-lg btn-primary" value="{% trans 'Submit' %}" type="submit"></td>
                                </tr>
                                {% endfor %}
                                </form>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="c-card-footer">
                        <input class="btn btn-lg btn-primary" value="{% trans 'Submit' %}" type="submit"></input>
                    </div>
                </div>
                <!-- Editable table -->
            </div>
        </div>
    </form>

{% endblock bodycontent %}
{% block c-script %}
    {#    <script src="https://maps.googleapis.com/maps/js?key=AIzaSyCYCDv3Xc3H2HVpNdvps3tYmky2HWxeT_E&callback=myMap"></script>#}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="{% static 'js/residence/custom_js.js' %}"></script>
    <script type="text/javascript">
    $(document).on('submit','#new_residence',function (e) {
{#        var count = $('tbody > tr').​​​​​length;#}
{#        post_data = {};#}
{#        for(var i=0;i<= count;i++){#}
{#            post_data['title'+i]= $('#id_title'+i).val(),#}
{#            post_data['description'+i]= $('#id_description'+i).val(),#}
{#            post_data['price'+i]= $('#id_price'+i).val(),#}
{#            post_data['requestable'+i]= $('#id_requestable'+i).val()#}
{#        }#}
        e.preventDefault();
        $.ajax({
            type:'POST',
            url: '/dashboard/residence/new/',
{#            dataType: 'json',#}
{#            contentType: 'application/json; charset=utf-8',#}
            data: {
                name: $('#id_name').val(),
                parent_name: $('#id_parent_name').val(),
                coordinate: $('#id_coordinate').val(),
                type: $('#id_type').val(),
                address: $('#id_address').val(),
                rules: $('#id_rules').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
{#                facility_data:post_data.val(),#}
{#                count: count#}
            },
             success:function(data) {
                $("#new_residence_message").html("<div class='alert alert-success'><a class='close' href='#' data-dismiss='alert'>×</a>Item added successfully!</div>");
            },
            error: function(data) {
                $("#new_residence_message").html("<div class='alert alert-danger'><a class='close' href='#' data-dismiss='alert'>×</a>something is Wrong!</div>");
            }
        });
    });
    </script>
    <script type="text/javascript">

        {#    if (request_type == 'edit'){#}
        $(document).on('submit', '#edit_facility', function (e) {
            e.preventDefault();
            // or display message in form, etc...
            $.ajax({
                type: 'PUT',
                url: '{% url "building:facility-residence-detail" facility.id %}',
                dataType: 'json',
                {#            contentType: 'application/json; charset=utf-8',#}
                data: {
                    id: $('#id_title').val(),
                    description: $('#id_description').val(),
                    price: $('#id_price').val(),
                    requestable: $('#id_requestable').val(),
                    {#                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()#}

                },
                success: function () {
                    $("#new_facility_message").html("<div class='alert alert-success'><a class='close' href='#' data-dismiss='alert'>×</a>{% trans 'Item Edited successfully!' %}</div>");
                },
                error: function () {
                    $("#new_facility_message").html("<div class='alert alert-danger'><a class='close' href='#' data-dismiss='alert'>×</a>{% trans 'something is Wrongs!' %}</div>");
                }
            });

        });
    </script>
{% endblock c-script %}