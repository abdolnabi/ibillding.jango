{% extends '../dashboard_base.html' %}{# in this Line, Parent of this Page will Define! #}
{% load static %}
{% block bodycontent %}
    <div id="new_residence_message"></div>
    <form class="form-horizontal" id="new_residence">
        {% csrf_token %}
        <div class="row">
            <div class="col-sm-6">
                <div class="card">
                    <div class="c-card-header">
                        <strong>Residence info</strong></div>
                    <div class="c-card-body">
                        <div class="form-group">
                            <label for="id_name">Name</label>
                            <input type="text" class="form-control" id="id_name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="id_parent_name">Parent Name</label>
                            <select class="form-control" id="id_parent_name" name="parent_name">
                                {% for residence in residences %}
                                    <option name="{{ residence.id }}"
                                            value="{{ residence.id }}">{{ residence.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="id_coordinate">Coordinate Points</label>
                            <input type="text" class="form-control" name="latitude" id="id_latitude"
                                   placeholder="Coordinate points"/>
                        </div>
                        <div class="form-group">
                            <label for="id_type">Select Type</label>
                            <select class="form-control" id="id_type" name="type">
                                <option>Apartment</option>
                                <option>Complex</option>
                                <option>Local Store</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="col-form-label" for="id_address">Address</label>
                            <textarea class="form-control" id="id_address" name="address" rows="1"
                                      placeholder="Address..." spellcheck="false"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="col-form-label" for="id_rules">Rules</label>
                            <textarea class="form-control" id="id_rules" name="rules" rows="1"
                                      placeholder="Rules.." spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!--  Second Part  -->
            <div class="col-sm-6">

                <div class="card">
                    <div class="c-card-header">
                        <strong>Set Coordinate Points</strong></div>
                    <div class="c-card-body">
                        <br/>
                        <br/>
                        <div id="map" class="map"></div>
                        <br/>
                        <br/>
                    </div>

                </div>
            </div>
        </div>
        <!-- third part of form -->
        <div class="row">
            <div class="col-lg-12">
                <!-- Editable table -->
                <div class="card">
                    <div class="c-card-header">
                        <strong>Residence Facilities</strong></div>
                    <div class="card-body">
                        <div id="table" class="table-editable">
                            <span class="table-add float-right mb-3 mr-2"><button class="c-btn c-btn-primary cil-plus"
                                                                                  id="addrow"
                                                                                  type="button"></button></span>
                            <table id="dataTable"
                                   class="dataTable table table-bordered table-responsive-md table-striped text-center">

                                <thead>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Requestable</th>
                                <th>َAction</th>
                                </thead>
                                <tbody id="tbody" class="center">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="c-card-footer">
                        <input class="btn btn-lg btn-primary" value="Submit" type="submit"></input>
                    </div>
                </div>
                <!-- Editable table -->
            </div>
        </div>
    </form>

{% endblock bodycontent %}
{% block c-script %}
    {#    <script src="https://maps.googleapis.com/maps/js?key=AIzaSyCYCDv3Xc3H2HVpNdvps3tYmky2HWxeT_E&callback=myMap"></script>#}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="{% static 'js/residence/custom_js.js' %}"></script>
    <script type="text/javascript">
    $(document).on('submit','#new_residence',function (e) {
{#        var count = $('tbody > tr').​​​​​length;#}
{#        post_data = {};#}
{#        for(var i=0;i<= count;i++){#}
{#            post_data['title'+i]= $('#id_title'+i).val(),#}
{#            post_data['description'+i]= $('#id_description'+i).val(),#}
{#            post_data['price'+i]= $('#id_price'+i).val(),#}
{#            post_data['requestable'+i]= $('#id_requestable'+i).val()#}
{#        }#}
        e.preventDefault();
        $.ajax({
            type:'POST',
            url: '/dashboard/residence/new/',
{#            dataType: 'json',#}
{#            contentType: 'application/json; charset=utf-8',#}
            data: {
                name: $('#id_name').val(),
                parent_name: $('#id_parent_name').val(),
                latitude: $('#id_latitude').val(),
                type: $('#id_type').val(),
                address: $('#id_address').val(),
                rules: $('#id_rules').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
{#                facility_data:post_data.val(),#}
{#                count: count#}
            },
             success:function(data) {
                $("#new_residence_message").html("<div class='alert alert-success'><a class='close' href='#' data-dismiss='alert'>×</a>Item added successfully!</div>");
            },
            error: function(data) {
                $("#new_residence_message").html("<div class='alert alert-danger'><a class='close' href='#' data-dismiss='alert'>×</a>something is Wrong!</div>");
            }
        });
    });
    </script>
{% endblock c-script %}